---
title: "R package - rabc: facilitating accelerometer analysis with visual tools"
author: "Yu Hui"
date: "18/06/2020"
output: 
  ioslides_presentation:
    incremental: yes
    logo: logo.png
    widescreen: yes
runtime: shiny
---

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_knit$set(root.dir = "/Users/yuhui/Desktop/rabc/rabc")
knitr::opts_chunk$set(cache = FALSE)
```

```{r global, include=FALSE}
library(rabc)
whitestork_acc_sorted <- order_acc(whitestork_acc)
df_time <- calculate_feature_time(whitestork_acc_sorted, winlen_dba = 11)
df_freq <- calculate_feature_freq(whitestork_acc_sorted, samp_freq = 10.5)
label_vec <- whitestork_acc_sorted$V121
```

## Workflow of rabc

```{r echo=FALSE, out.height="70%"}
knitr::include_graphics(here::here("rabc_Diagram.jpeg"))
```

## ACC data with behaviour labels

- Behaviour labels are essential for supervised machine learning methods
- Position of a tracker on animal influence what behaviours could be recoganized
- Even length segements of ACC data in rabc package

## ACC data visualization
Using dynamic gragh to visualize ACC data

```{r include=FALSE}
library(rabc)
data("whitestork_acc")
whitestork_acc_sorted <- order_acc(whitestork_acc)
label_vec <- whitestork_acc_sorted$V121
```

```{r echo=TRUE, warning=FALSE, fig.height=4}
plot_acc(df_raw = whitestork_acc_sorted, axis_num = 3)
```

## Feature calculation

Features are mathematical summaries of original ACC data.

```{r echo=TRUE, warning=FALSE, eval=FALSE}
df_time <- calculate_feature_time(whitestork_acc_sorted, winlen_dba = 11)
df_freq <- calculate_feature_freq(whitestork_acc_sorted, samp_freq = 10.5)
```

- Time domain features include: mean, variance, standard deviation, max, min, range and ODBA (Overall Dynamic Body Acceleration). 

- Frequency domain features include: main frequency, main amplitude, frequency entropy.

## Feature selection {.build}

A process of selecting a subset of relevant features for model construction.

- Less feautures are easier to understand and explain.
- Enhancing generalizations.
- Potential for on-board calculation.

In **rabc** package, a combination of *filter* (reduce redundant features) and *wrapper* (select most relevant features) method is used. The *wrapper* uses XGBoost (extrem gradient boosting) method as it is a fast speed and high accuracy supervised machine learning method.

## Feature selection 

```{r warning=FALSE, echo=TRUE, message=FALSE}
selection <- select_features(df_time, label_vec, no_features = 10)
plot_selection_accuracy(results = selection)
```

## Feature visualization

### Feature sequential visualization

```{r warning=FALSE, echo=TRUE, fig.height=4}
plot_feature(df_feature = df_time[, selection[[2]][1:6]], label_vec)
```

## Feature visualization
### Feature group visualization

```{r warning=FALSE, echo=TRUE, fig.height=4}
plot_grouped_feature(df_time[, selection[[2]][1:6]], label_vec, geom = "density")
```

## UMAP

```{r warning=FALSE}
plot_UMAP()
```

## Model training and validation {.build}
1. hyperparameter tuning
2. model training with optimal hyperparameters and validation

Function **train_model** is a wrapper function that utilizes relevant functions from the “caret” package to automatically conduct the above steps for model construction and evaluation. 

## Model training and validation output
```{r warning=FALSE, echo=TRUE, fig.height=4}
pred <- rabc::plot_confusion_matrix(df_time, label_vec)
```

## Wrong classifications visualization
A way to check and understand wrong classifications
```{r warning=FALSE, echo=TRUE, fig.height=4}
plot_wrong_classifications(whitestork_acc_sorted, df_result = pred)
```

##  
Thank you


## Model training and validation output
```{r warning=FALSE, echo=TRUE, fig.height=4}
pred <- rabc::plot_confusion_matrix(df_time, label_vec)
```
## Model training and validation output
```{r warning=FALSE, echo=TRUE, fig.height=4}
pred <- rabc::plot_confusion_matrix(df_time, label_vec)
```
## Model training and validation output
```{r warning=FALSE, echo=TRUE, fig.height=4}
pred <- rabc::plot_confusion_matrix(df_time, label_vec)
```
